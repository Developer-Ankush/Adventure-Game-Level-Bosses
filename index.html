<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitGuts - GitHub RPG Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0d1117 0%, #161b22 50%, #21262d 100%);
            color: #e6edf3;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Consolas', monospace;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(45deg, #238636, #2ea043);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(35, 134, 54, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(-20px) rotate(360deg); }
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
            position: relative;
            z-index: 1;
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .game-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(33, 38, 45, 0.8);
            border: 2px solid #30363d;
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .panel:hover {
            border-color: #238636;
            box-shadow: 0 8px 32px rgba(35, 134, 54, 0.2);
        }

        .panel h2 {
            color: #2ea043;
            margin-bottom: 15px;
            font-size: 1.4rem;
            text-align: center;
            border-bottom: 2px solid #30363d;
            padding-bottom: 10px;
        }

        .character-stats {
            display: grid;
            gap: 10px;
        }

        .stat-bar {
            background: #21262d;
            border-radius: 8px;
            padding: 8px 12px;
            position: relative;
            overflow: hidden;
        }

        .stat-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            border-radius: 8px;
            transition: width 0.3s ease;
        }

        .hp-fill { background: linear-gradient(90deg, #f85149, #ff6b6b); }
        .mp-fill { background: linear-gradient(90deg, #1f6feb, #58a6ff); }
        .xp-fill { background: linear-gradient(90deg, #ffd700, #ffeb3b); }

        .stat-text {
            position: relative;
            z-index: 1;
            font-weight: bold;
        }

        .location-panel {
            text-align: center;
        }

        .location-name {
            font-size: 1.8rem;
            color: #ffd700;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .location-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(35, 134, 54, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .inventory-slot {
            aspect-ratio: 1;
            background: #21262d;
            border: 2px solid #30363d;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .inventory-slot:hover {
            border-color: #ffd700;
            transform: scale(1.05);
        }

        .inventory-slot.filled {
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
            color: #1a1a1a;
        }

        .log-panel {
            grid-column: 1 / -1;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            background: rgba(13, 17, 23, 0.6);
            margin-bottom: 8px;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 3px solid #30363d;
            animation: slideIn 0.3s ease;
        }

        .log-entry.combat { border-left-color: #f85149; }
        .log-entry.exploration { border-left-color: #2ea043; }
        .log-entry.loot { border-left-color: #ffd700; }
        .log-entry.system { border-left-color: #58a6ff; }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .github-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .github-stat {
            text-align: center;
            background: rgba(13, 17, 23, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30363d;
        }

        .github-stat .value {
            font-size: 2rem;
            font-weight: bold;
            color: #2ea043;
            display: block;
        }

        .monster-encounter {
            background: linear-gradient(135deg, #da3633, #f85149);
            border: 2px solid #f85149;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .treasure-found {
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
            border: 2px solid #ffd700;
            animation: glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px #ffd700; }
            to { box-shadow: 0 0 20px #ffd700, 0 0 30px #ffd700; }
        }

        .commit-message {
            background: rgba(35, 134, 54, 0.1);
            border: 1px solid #2ea043;
            border-radius: 6px;
            padding: 8px 12px;
            font-family: inherit;
            color: #e6edf3;
            margin-top: 10px;
            width: 100%;
        }

        .reset-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #f85149, #da3633);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(248, 81, 73, 0.4);
            z-index: 1000;
        }

        .reset-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(248, 81, 73, 0.6);
        }

        .boss-panel {
            background: linear-gradient(135deg, #da3633, #f85149);
            border: 3px solid #f85149;
            animation: bossGlow 2s infinite;
        }

        @keyframes bossGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(248, 81, 73, 0.5); }
            50% { box-shadow: 0 0 30px rgba(248, 81, 73, 0.8); }
        }

        .boss-hp-bar {
            background: #1a1a1a;
            height: 20px;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            border: 2px solid #f85149;
        }

        .boss-hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #f85149, #ff6b6b);
            transition: width 0.5s ease;
        }

        .task-list {
            margin-top: 15px;
        }

        .task-item {
            background: rgba(13, 17, 23, 0.6);
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            border-left: 3px solid #ffd700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-item.completed {
            border-left-color: #2ea043;
            opacity: 0.7;
        }

        .task-progress {
            font-size: 0.9rem;
            color: #ffd700;
        }

        .death-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
        }

        .death-message {
            color: #f85149;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .countdown {
            color: #ffd700;
            font-size: 2rem;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .game-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .github-stats {
                grid-template-columns: 1fr;
            }

            .reset-button {
                bottom: 10px;
                left: 10px;
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #2ea043;
            border-radius: 50%;
            animation: floatUp 10s infinite linear;
        }

        @keyframes floatUp {
            0% {
                opacity: 0;
                transform: translateY(100vh) scale(0);
            }
            10% {
                opacity: 1;
                transform: translateY(90vh) scale(1);
            }
            90% {
                opacity: 1;
                transform: translateY(10vh) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-10vh) scale(0);
            }
        }
    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>
    
    <div class="container">
        <button class="reset-button" onclick="resetGame()">🔄 Reset Game</button>
        
        <div class="death-overlay" id="deathOverlay">
            <div class="death-message">💀 GAME OVER 💀</div>
            <div>Your adventure has ended...</div>
            <div class="countdown" id="countdown">Resetting in 5 seconds...</div>
        </div>

        <div class="header">
            <h1>🎮 GitGuts</h1>
            <p class="subtitle">The Ultimate GitHub RPG Adventure • Where Your Commits Tell Your Story</p>
        </div>

        <div class="game-grid">
            <!-- Character Panel -->
            <div class="panel">
                <h2>⚔️ Character</h2>
                <div class="character-stats">
                    <div class="stat-bar">
                        <div class="stat-fill hp-fill" id="hp-fill" style="width: 100%"></div>
                        <div class="stat-text">❤️ HP: <span id="hp">100</span>/100</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill mp-fill" id="mp-fill" style="width: 100%"></div>
                        <div class="stat-text">⚡ MP: <span id="mp">100</span>/100</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill xp-fill" id="xp-fill" style="width: 0%"></div>
                        <div class="stat-text">⭐ XP: <span id="xp">0</span>/100</div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-text">🏆 Level: <span id="level">1</span></div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-text">💰 Gold: <span id="gold">50</span></div>
                    </div>
                </div>
            </div>

            <!-- Location Panel -->
            <div class="panel">
                <h2>🗺️ Current Location</h2>
                <div class="location-name" id="location-name">Enchanted Forest</div>
                <div class="location-image" id="location-image">
                    🌲
                </div>
                <p id="location-description">A mystical forest where ancient magic flows through twisted branches. Strange creatures lurk in the shadows, and treasures await the brave.</p>
                
                <div class="action-buttons">
                    <button class="btn" onclick="explore()">🔍 Explore</button>
                    <button class="btn" onclick="rest()">🏕️ Rest</button>
                    <button class="btn" onclick="moveLocation()">🚶 Move</button>
                    <button class="btn" onclick="fightBoss()" id="boss-btn" style="display: none;">⚔️ Fight Boss</button>
                </div>
                
                <!-- Boss Panel -->
                <div id="boss-panel" class="boss-panel" style="display: none; margin-top: 15px; padding: 15px; border-radius: 8px;">
                    <div style="text-align: center;">
                        <div id="boss-name" style="font-size: 1.5rem; color: #ffd700; margin-bottom: 10px;"></div>
                        <div id="boss-emoji" style="font-size: 3rem; margin-bottom: 10px;"></div>
                        <div class="boss-hp-bar">
                            <div class="boss-hp-fill" id="boss-hp-fill" style="width: 100%;"></div>
                        </div>
                        <div id="boss-hp-text" style="color: white; font-weight: bold;"></div>
                        <div id="boss-attempts" style="color: #ffd700; margin-top: 10px;"></div>
                    </div>
                </div>

                <!-- Tasks Panel -->
                <div class="task-list">
                    <h3 style="color: #ffd700; margin-bottom: 10px;">📋 Area Tasks</h3>
                    <div id="tasks-container">
                        <!-- Tasks will be populated by JavaScript -->
                    </div>
                </div>
                
                <input type="text" class="commit-message" id="commit-msg" placeholder="Enter commit message for your action...">
            </div>

            <!-- Inventory Panel -->
            <div class="panel">
                <h2>🎒 Inventory</h2>
                <div class="inventory-grid" id="inventory">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div style="margin-top: 15px;">
                    <button class="btn" onclick="useItem()" style="width: 100%;">🎒 Use Selected Item</button>
                </div>
            </div>
        </div>

        <!-- Adventure Log -->
        <div class="panel log-panel">
            <h2>📜 Adventure Log (Recent Commits)</h2>
            <div id="adventure-log">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- GitHub Integration Stats -->
        <div class="panel">
            <h2>📊 GitHub Integration</h2>
            <div class="github-stats">
                <div class="github-stat">
                    <span class="value" id="commits-count">0</span>
                    <span>Total Commits</span>
                </div>
                <div class="github-stat">
                    <span class="value" id="adventures-count">0</span>
                    <span>Adventures</span>
                </div>
                <div class="github-stat">
                    <span class="value" id="monsters-defeated">0</span>
                    <span>Monsters Defeated</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            player: {
                hp: 100, maxHp: 100,
                mp: 100, maxMp: 100,
                xp: 0, maxXp: 100,
                level: 1,
                gold: 50,
                bossAttempts: 0
            },
            location: {
                name: "Enchanted Forest",
                emoji: "🌲",
                description: "A mystical forest where ancient magic flows through twisted branches. Strange creatures lurk in the shadows, and treasures await the brave.",
                index: 0,
                bossDefeated: false
            },
            inventory: [
                { name: "Basic Sword", emoji: "⚔️", type: "weapon", power: 15, special: "forest" },
                { name: "Health Potion", emoji: "🧪", type: "consumable", power: 30 },
                null, null, null, null, null, null,
                null, null, null, null, null, null, null, null
            ],
            tasks: [],
            currentBoss: null,
            stats: {
                commits: 0,
                adventures: 0,
                monstersDefeated: 0
            }
        };

        const locations = [
            { 
                name: "Enchanted Forest", 
                emoji: "🌲", 
                description: "A mystical forest where ancient magic flows through twisted branches.",
                boss: { name: "Forest Guardian", emoji: "🧙‍♂️", hp: 150, maxHp: 150 },
                tasks: [
                    { name: "Defeat 3 Shadow Wolves", progress: 0, required: 3, type: "combat" },
                    { name: "Find 2 Magic Herbs", progress: 0, required: 2, type: "collect" },
                    { name: "Discover the Ancient Grove", progress: 0, required: 1, type: "explore" }
                ]
            },
            { 
                name: "Crystal Caverns", 
                emoji: "💎", 
                description: "Deep underground caves filled with glowing crystals and ancient secrets.",
                boss: { name: "Crystal Dragon", emoji: "🐲", hp: 200, maxHp: 200 },
                tasks: [
                    { name: "Mine 5 Crystal Shards", progress: 0, required: 5, type: "collect" },
                    { name: "Defeat 2 Crystal Golems", progress: 0, required: 2, type: "combat" },
                    { name: "Activate the Crystal Altar", progress: 0, required: 1, type: "explore" }
                ]
            },
            { 
                name: "Haunted Castle", 
                emoji: "🏰", 
                description: "An abandoned fortress where ghosts roam the crumbling halls.",
                boss: { name: "Phantom King", emoji: "👑", hp: 250, maxHp: 250 },
                tasks: [
                    { name: "Banish 4 Lost Souls", progress: 0, required: 4, type: "combat" },
                    { name: "Collect 3 Soul Fragments", progress: 0, required: 3, type: "collect" },
                    { name: "Unlock the Throne Room", progress: 0, required: 1, type: "explore" }
                ]
            },
            { 
                name: "Desert Oasis", 
                emoji: "🏜️", 
                description: "A rare sanctuary in the endless desert, hiding mysterious artifacts.",
                boss: { name: "Sand Sphinx", emoji: "🦁", hp: 300, maxHp: 300 },
                tasks: [
                    { name: "Solve 3 Ancient Riddles", progress: 0, required: 3, type: "explore" },
                    { name: "Defeat 5 Sand Vipers", progress: 0, required: 5, type: "combat" },
                    { name: "Find the Hidden Pyramid", progress: 0, required: 1, type: "explore" }
                ]
            },
            { 
                name: "Frozen Peaks", 
                emoji: "🏔️", 
                description: "Treacherous mountain tops where ice elementals guard ancient treasures.",
                boss: { name: "Ice Titan", emoji: "❄️", hp: 400, maxHp: 400 },
                tasks: [
                    { name: "Climb 3 Frozen Cliffs", progress: 0, required: 3, type: "explore" },
                    { name: "Defeat 4 Ice Wraiths", progress: 0, required: 4, type: "combat" },
                    { name: "Retrieve the Frozen Crown", progress: 0, required: 1, type: "collect" }
                ]
            },
            { 
                name: "Pirate Cove", 
                emoji: "🏴‍☠️", 
                description: "A hidden bay where supernatural pirates dock their ghostly ships.",
                boss: { name: "Ghost Captain", emoji: "🏴‍☠️", hp: 500, maxHp: 500 },
                tasks: [
                    { name: "Sink 6 Ghost Ships", progress: 0, required: 6, type: "combat" },
                    { name: "Find 4 Treasure Chests", progress: 0, required: 4, type: "collect" },
                    { name: "Navigate the Cursed Waters", progress: 0, required: 1, type: "explore" }
                ]
            }
        ];

        const weapons = [
            { name: "Basic Sword", emoji: "⚔️", power: 15, special: "forest" },
            { name: "Crystal Blade", emoji: "🗡️", power: 25, special: "caverns" },
            { name: "Holy Sword", emoji: "⚔️", power: 35, special: "castle" },
            { name: "Desert Scimitar", emoji: "🏹", power: 45, special: "desert" },
            { name: "Ice Axe", emoji: "🪓", power: 55, special: "peaks" },
            { name: "Cutlass", emoji: "⚔️", power: 65, special: "cove" }
        ];

        const items = [
            { name: "Health Potion", emoji: "🧪", type: "consumable", power: 30 },
            { name: "Mana Potion", emoji: "🍶", type: "consumable", power: 40 },
            { name: "Magic Crystal", emoji: "💎", type: "special", power: 0, special: "all" },
            { name: "Ancient Key", emoji: "🗝️", type: "key", power: 0 },
            { name: "Shield", emoji: "🛡️", type: "armor", power: 10 },
            { name: "Magic Scroll", emoji: "📜", type: "spell", power: 50 }
        ];

        let selectedInventorySlot = null;

        // Initialize game
        function initGame() {
            updateDisplay();
            createParticles();
            populateInventory();
            populateAdventureLog();
            loadLocationTasks();
            checkBossAvailability();
        }

        function resetGameState() {
            gameState = {
                player: {
                    hp: 100, maxHp: 100,
                    mp: 100, maxMp: 100,
                    xp: 0, maxXp: 100,
                    level: 1,
                    gold: 50,
                    bossAttempts: 0
                },
                location: {
                    name: "Enchanted Forest",
                    emoji: "🌲",
                    description: "A mystical forest where ancient magic flows through twisted branches. Strange creatures lurk in the shadows, and treasures await the brave.",
                    index: 0,
                    bossDefeated: false
                },
                inventory: [
                    { name: "Basic Sword", emoji: "⚔️", type: "weapon", power: 15, special: "forest" },
                    { name: "Health Potion", emoji: "🧪", type: "consumable", power: 30 },
                    null, null, null, null, null, null,
                    null, null, null, null, null, null, null, null
                ],
                tasks: [],
                currentBoss: null,
                stats: {
                    commits: 0,
                    adventures: 0,
                    monstersDefeated: 0
                }
            };
            selectedInventorySlot = null;
        }

        function resetGame() {
            if (confirm('Are you sure you want to reset your adventure? All progress will be lost!')) {
                resetGameState();
                updateDisplay();
                populateInventory();
                populateAdventureLog();
                loadLocationTasks();
                checkBossAvailability();
                addLogEntry('system', '🔄 Game reset! Starting a new adventure...');
            }
        }

        function updateDisplay() {
            // Update player stats
            document.getElementById('hp').textContent = gameState.player.hp;
            document.getElementById('mp').textContent = gameState.player.mp;
            document.getElementById('xp').textContent = gameState.player.xp;
            document.getElementById('level').textContent = gameState.player.level;
            document.getElementById('gold').textContent = gameState.player.gold;

            // Update stat bars
            document.getElementById('hp-fill').style.width = (gameState.player.hp / gameState.player.maxHp * 100) + '%';
            document.getElementById('mp-fill').style.width = (gameState.player.mp / gameState.player.maxMp * 100) + '%';
            document.getElementById('xp-fill').style.width = (gameState.player.xp / gameState.player.maxXp * 100) + '%';

            // Update location
            document.getElementById('location-name').textContent = gameState.location.name;
            document.getElementById('location-image').textContent = gameState.location.emoji;
            document.getElementById('location-description').textContent = gameState.location.description;

            // Update GitHub stats
            document.getElementById('commits-count').textContent = gameState.stats.commits;
            document.getElementById('adventures-count').textContent = gameState.stats.adventures;
            document.getElementById('monsters-defeated').textContent = gameState.stats.monstersDefeated;
        }

        function loadLocationTasks() {
            const currentLocation = locations[gameState.location.index];
            gameState.tasks = JSON.parse(JSON.stringify(currentLocation.tasks)); // Deep copy
            updateTasksDisplay();
        }

        function updateTasksDisplay() {
            const tasksContainer = document.getElementById('tasks-container');
            tasksContainer.innerHTML = '';

            gameState.tasks.forEach((task, index) => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${task.progress >= task.required ? 'completed' : ''}`;
                taskElement.innerHTML = `
                    <span>${task.name}</span>
                    <span class="task-progress">${task.progress}/${task.required}</span>
                `;
                tasksContainer.appendChild(taskElement);
            });
        }

        function checkBossAvailability() {
            const allTasksCompleted = gameState.tasks.every(task => task.progress >= task.required);
            const bossBtn = document.getElementById('boss-btn');
            const bossPanel = document.getElementById('boss-panel');
            
            if (allTasksCompleted && !gameState.location.bossDefeated) {
                bossBtn.style.display = 'inline-block';
                setupBoss();
            } else {
                bossBtn.style.display = 'none';
                bossPanel.style.display = 'none';
            }
        }

        function setupBoss() {
            const currentLocation = locations[gameState.location.index];
            gameState.currentBoss = JSON.parse(JSON.stringify(currentLocation.boss)); // Deep copy
            gameState.player.bossAttempts = 0;
            updateBossDisplay();
        }

        function updateBossDisplay() {
            if (!gameState.currentBoss) return;
            
            const bossPanel = document.getElementById('boss-panel');
            const bossName = document.getElementById('boss-name');
            const bossEmoji = document.getElementById('boss-emoji');
            const bossHpFill = document.getElementById('boss-hp-fill');
            const bossHpText = document.getElementById('boss-hp-text');
            const bossAttempts = document.getElementById('boss-attempts');
            
            bossPanel.style.display = 'block';
            bossName.textContent = gameState.currentBoss.name;
            bossEmoji.textContent = gameState.currentBoss.emoji;
            
            const hpPercentage = (gameState.currentBoss.hp / gameState.currentBoss.maxHp) * 100;
            bossHpFill.style.width = hpPercentage + '%';
            bossHpText.textContent = `${gameState.currentBoss.hp}/${gameState.currentBoss.maxHp} HP`;
            bossAttempts.textContent = `Attempts: ${gameState.player.bossAttempts}/3`;
        }

        function populateInventory() {
            const inventoryGrid = document.getElementById('inventory');
            inventoryGrid.innerHTML = '';

            for (let i = 0; i < 16; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                slot.onclick = () => selectInventorySlot(i);
                
                if (gameState.inventory[i]) {
                    slot.classList.add('filled');
                    slot.textContent = gameState.inventory[i].emoji;
                    slot.title = `${gameState.inventory[i].name} - ${gameState.inventory[i].type}`;
                } else {
                    slot.textContent = '+';
                }

                if (selectedInventorySlot === i) {
                    slot.style.border = '2px solid #ffd700';
                    slot.style.boxShadow = '0 0 10px #ffd700';
                }
                
                inventoryGrid.appendChild(slot);
            }
        }

        function selectInventorySlot(index) {
            selectedInventorySlot = selectedInventorySlot === index ? null : index;
            populateInventory();
        }

        function explore() {
            const commitMsg = document.getElementById('commit-msg').value || 'Exploring the unknown...';
            const outcomes = ['combat', 'treasure', 'task_progress', 'secret'];
            const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];

            switch(outcome) {
                case 'combat':
                    handleCombat(commitMsg);
                    break;
                case 'treasure':
                    handleTreasure(commitMsg);
                    break;
                case 'task_progress':
                    handleTaskProgress(commitMsg);
                    break;
                case 'secret':
                    handleSecret(commitMsg);
                    break;
            }

            document.getElementById('commit-msg').value = '';
            gameState.stats.adventures++;
            updateDisplay();
            updateTasksDisplay();
            checkBossAvailability();
        }

        function handleCombat(commitMsg) {
            const monsters = getLocationMonsters();
            const monster = monsters[Math.floor(Math.random() * monsters.length)];
            
            // Check if player has weapon advantage
            const weapon = getEquippedWeapon();
            let damage = Math.floor(Math.random() * 20) + 10;
            let playerDamage = weapon ? weapon.power : 10;
            
            // Special weapon bonus for current location
            if (weapon && weapon.special === getLocationSpecial()) {
                playerDamage *= 1.5;
                addLogEntry('combat', `🌟 ${weapon.name} deals extra damage in this area!`);
            }

            gameState.player.hp = Math.max(0, gameState.player.hp - damage);
            
            const xpGain = Math.floor(Math.random() * 30) + 20;
            const goldGain = Math.floor(Math.random() * 25) + 10;
            
            gameState.player.xp += xpGain;
            gameState.player.gold += goldGain;
            gameState.stats.monstersDefeated++;
            
            // Update combat tasks
            gameState.tasks.forEach(task => {
                if (task.type === 'combat' && task.progress < task.required) {
                    task.progress++;
                }
            });
            
            addLogEntry('combat', `${commitMsg} - Defeated ${monster.name} ${monster.emoji}! Lost ${damage} HP, gained ${xpGain} XP and ${goldGain} gold.`);
            checkLevelUp();
            checkDeath();

            // Add visual effect
            document.querySelector('.location-image').classList.add('monster-encounter');
            setTimeout(() => {
                document.querySelector('.location-image').classList.remove('monster-encounter');
            }, 2000);
        }

        function handleTreasure(commitMsg) {
            const treasures = getLocationTreasures();
            const treasure = treasures[Math.floor(Math.random() * treasures.length)];
            const goldFind = Math.floor(Math.random() * 50) + 20;
            
            gameState.player.gold += goldFind;
            addLogEntry('loot', `${commitMsg} - Found ${treasure.name} ${treasure.emoji} and ${goldFind} gold!`);
            
            // Add to inventory if there's space
            const emptySlot = gameState.inventory.findIndex(slot => slot === null);
            if (emptySlot !== -1) {
                gameState.inventory[emptySlot] = treasure;
                populateInventory();
            }

            // Update collect tasks
            gameState.tasks.forEach(task => {
                if (task.type === 'collect' && task.progress < task.required) {
                    task.progress++;
                }
            });
            
            // Add visual effect
            document.querySelector('.location-image').classList.add('treasure-found');
            setTimeout(() => {
                document.querySelector('.location-image').classList.remove('treasure-found');
            }, 2000);
        }

        function handleTaskProgress(commitMsg) {
            const incompleteTasks = gameState.tasks.filter(task => task.progress < task.required && task.type === 'explore');
            if (incompleteTasks.length > 0) {
                const task = incompleteTasks[Math.floor(Math.random() * incompleteTasks.length)];
                task.progress++;
                addLogEntry('exploration', `${commitMsg} - Made progress on: ${task.name}!`);
            } else {
                addLogEntry('exploration', `${commitMsg} - Explored the area but found nothing new.`);
            }
        }

        function handleSecret(commitMsg) {
            const secretXp = Math.floor(Math.random() * 40) + 30;
            gameState.player.xp += secretXp;
            addLogEntry('exploration', `${commitMsg} - Discovered a hidden secret! Gained ${secretXp} XP.`);
            checkLevelUp();
        }

        function getLocationMonsters() {
            const monsters = {
                0: [{ name: "Shadow Wolf", emoji: "🐺" }, { name: "Forest Sprite", emoji: "🧚" }],
                1: [{ name: "Crystal Golem", emoji: "🗿" }, { name: "Cave Bat", emoji: "🦇" }],
                2: [{ name: "Phantom Knight", emoji: "👻" }, { name: "Lost Soul", emoji: "💀" }],
                3: [{ name: "Sand Viper", emoji: "🐍" }, { name: "Desert Nomad", emoji: "🏜️" }],
                4: [{ name: "Ice Wraith", emoji: "❄️" }, { name: "Frost Giant", emoji: "🧊" }],
                5: [{ name: "Ghost Pirate", emoji: "🏴‍☠️" }, { name: "Sea Serpent", emoji: "🐍" }]
            };
            return monsters[gameState.location.index] || monsters[0];
        }

        function getLocationTreasures() {
            const treasures = {
                0: [{ name: "Magic Herb", emoji: "🌿", type: "consumable", power: 20 }, { name: "Forest Crystal", emoji: "💚", type: "misc" }],
                1: [{ name: "Crystal Shard", emoji: "💎", type: "misc" }, { name: "Cave Potion", emoji: "🧪", type: "consumable", power: 25 }],
                2: [{ name: "Soul Fragment", emoji: "👻", type: "misc" }, { name: "Cursed Ring", emoji: "💍", type: "accessory" }],
                3: [{ name: "Desert Gem", emoji: "🟡", type: "misc" }, { name: "Sand Scroll", emoji: "📜", type: "spell", power: 40 }],
                4: [{ name: "Ice Crystal", emoji: "🧊", type: "misc" }, { name: "Frozen Elixir", emoji: "🧪", type: "consumable", power: 35 }],
                5: [{ name: "Pirate Gold", emoji: "🪙", type: "currency" }, { name: "Sea Charm", emoji: "🌊", type: "accessory" }]
            };
            return treasures[gameState.location.index] || treasures[0];
        }

        function getEquippedWeapon() {
            return gameState.inventory.find(item => item && item.type === 'weapon');
        }

        function getLocationSpecial() {
            const specials = ['forest', 'caverns', 'castle', 'desert', 'peaks', 'cove'];
            return specials[gameState.location.index] || 'forest';
        }

        function checkLevelUp() {
            if (gameState.player.xp >= gameState.player.maxXp) {
                gameState.player.level++;
                gameState.player.xp = 0;
                gameState.player.maxXp = Math.floor(gameState.player.maxXp * 1.5);
                gameState.player.maxHp += 20;
                gameState.player.hp = gameState.player.maxHp; // Full heal on level up
                gameState.player.maxMp += 15;
                gameState.player.mp = gameState.player.maxMp;
                
                const newMaxAttempts = getMaxBossAttempts();
                addLogEntry('system', `🎉 Level Up! You are now level ${gameState.player.level}! HP and MP fully restored. Boss attempts increased to ${newMaxAttempts}!`);
                
                // Award location-specific weapon
                if (gameState.player.level > gameState.location.index + 1) {
                    const newWeapon = weapons[gameState.location.index + 1];
                    if (newWeapon) {
                        const emptySlot = gameState.inventory.findIndex(slot => slot === null);
                        if (emptySlot !== -1) {
                            gameState.inventory[emptySlot] = { ...newWeapon };
                            addLogEntry('loot', `🎁 Received ${newWeapon.name} ${newWeapon.emoji} for reaching level ${gameState.player.level}!`);
                            populateInventory();
                        }
                    }
                }
                
                // Update boss display to show new attempt count if boss is active
                if (gameState.currentBoss) {
                    updateBossDisplay();
                }
            }
        }

        function checkDeath() {
            if (gameState.player.hp <= 0) {
                showDeathScreen();
            }
        }

        function showDeathScreen() {
            const deathOverlay = document.getElementById('deathOverlay');
            deathOverlay.style.display = 'flex';
            
            let countdown = 5;
            const countdownElement = document.getElementById('countdown');
            
            const countdownInterval = setInterval(() => {
                countdownElement.textContent = `Resetting in ${countdown} seconds...`;
                countdown--;
                
                if (countdown < 0) {
                    clearInterval(countdownInterval);
                    deathOverlay.style.display = 'none';
                    resetGameState();
                    updateDisplay();
                    populateInventory();
                    populateAdventureLog();
                    loadLocationTasks();
                    checkBossAvailability();
                    addLogEntry('system', '💀 You died and respawned at the beginning of your journey...');
                }
            }, 1000);
        }

        function fightBoss() {
            if (!gameState.currentBoss) return;
            
            const commitMsg = document.getElementById('commit-msg').value || 'Challenging the area boss...';
            gameState.player.bossAttempts++;
            
            const weapon = getEquippedWeapon();
            let playerDamage = weapon ? weapon.power : 10;
            
            // Special weapon bonus
            if (weapon && weapon.special === getLocationSpecial()) {
                playerDamage *= 2; // Double damage with correct weapon
                addLogEntry('combat', `✨ ${weapon.name} is super effective against ${gameState.currentBoss.name}!`);
            }
            
            // Boss damage to player
            const bossDamage = Math.floor(Math.random() * 30) + 20;
            gameState.player.hp = Math.max(0, gameState.player.hp - bossDamage);
            
            // Player damage to boss
            gameState.currentBoss.hp = Math.max(0, gameState.currentBoss.hp - playerDamage);
            
            addLogEntry('combat', `${commitMsg} - Fought ${gameState.currentBoss.name}! You dealt ${playerDamage} damage, took ${bossDamage} damage.`);
            
            if (gameState.currentBoss.hp <= 0) {
                // Boss defeated
                gameState.location.bossDefeated = true;
                const xpReward = 100 * (gameState.location.index + 1);
                const goldReward = 200 * (gameState.location.index + 1);
                
                gameState.player.xp += xpReward;
                gameState.player.gold += goldReward;
                
                addLogEntry('combat', `🏆 BOSS DEFEATED! ${gameState.currentBoss.name} has been vanquished! Gained ${xpReward} XP and ${goldReward} gold!`);
                
                // Unlock next location
                if (gameState.location.index < locations.length - 1) {
                    addLogEntry('system', '🌟 New location unlocked! You can now move to the next area.');
                }
                
                gameState.currentBoss = null;
                updateBossDisplay();
                checkBossAvailability();
                checkLevelUp();
            } else if (gameState.player.bossAttempts >= 3) {
                // Failed after 3 attempts
                addLogEntry('combat', `💀 Failed to defeat ${gameState.currentBoss.name} after 3 attempts...`);
                showDeathScreen();
                return;
            }
            
            updateBossDisplay();
            checkDeath();
            document.getElementById('commit-msg').value = '';
            updateDisplay();
        }

        function moveLocation() {
            const commitMsg = document.getElementById('commit-msg').value || 'Venturing to new lands...';
            
            // Can only move to next location if current boss is defeated
            if (!gameState.location.bossDefeated && gameState.location.index > 0) {
                addLogEntry('system', '🚫 You must defeat the area boss before moving to a new location!');
                document.getElementById('commit-msg').value = '';
                return;
            }
            
            // Move to next location if available
            if (gameState.location.index < locations.length - 1 && gameState.location.bossDefeated) {
                gameState.location.index++;
                const newLocation = locations[gameState.location.index];
                gameState.location.name = newLocation.name;
                gameState.location.emoji = newLocation.emoji;
                gameState.location.description = newLocation.description;
                gameState.location.bossDefeated = false;
                
                // Reset boss attempts when moving to new location
                gameState.player.bossAttempts = 0;
                
                loadLocationTasks();
                addLogEntry('exploration', `${commitMsg} - Traveled to ${newLocation.name} ${newLocation.emoji}!`);
            } else if (gameState.location.index === locations.length - 1 && gameState.location.bossDefeated) {
                addLogEntry('system', '🎊 Congratulations! You have completed all locations! You are a true hero!');
            } else {
                // Move within current location
                addLogEntry('exploration', `${commitMsg} - Explored different areas of ${gameState.location.name}.`);
            }
            
            document.getElementById('commit-msg').value = '';
            updateDisplay();
            checkBossAvailability();
        }

        function useItem() {
            if (selectedInventorySlot === null || !gameState.inventory[selectedInventorySlot]) {
                addLogEntry('system', 'Please select an item from your inventory first.');
                return;
            }

            const item = gameState.inventory[selectedInventorySlot];
            const commitMsg = document.getElementById('commit-msg').value || `Using ${item.name}...`;

            switch(item.type) {
                case 'consumable':
                    if (item.name.includes('Health') || item.name.includes('Herb')) {
                        const healing = Math.min(item.power, gameState.player.maxHp - gameState.player.hp);
                        gameState.player.hp += healing;
                        addLogEntry('system', `${commitMsg} - Used ${item.name} ${item.emoji}! Restored ${healing} HP.`);
                    } else if (item.name.includes('Mana') || item.name.includes('Potion')) {
                        const mpRestore = Math.min(item.power, gameState.player.maxMp - gameState.player.mp);
                        gameState.player.mp += mpRestore;
                        addLogEntry('system', `${commitMsg} - Used ${item.name} ${item.emoji}! Restored ${mpRestore} MP.`);
                    }
                    
                    // Remove consumable item
                    gameState.inventory[selectedInventorySlot] = null;
                    selectedInventorySlot = null;
                    populateInventory();
                    break;

                case 'weapon':
                    addLogEntry('system', `${commitMsg} - Equipped ${item.name} ${item.emoji}! This weapon is effective in ${item.special} areas.`);
                    break;

                case 'spell':
                    if (gameState.player.mp >= 20) {
                        gameState.player.mp -= 20;
                        const spellDamage = item.power;
                        addLogEntry('system', `${commitMsg} - Cast spell from ${item.name} ${item.emoji}! Would deal ${spellDamage} damage to enemies.`);
                        
                        // Remove spell scroll
                        gameState.inventory[selectedInventorySlot] = null;
                        selectedInventorySlot = null;
                        populateInventory();
                    } else {
                        addLogEntry('system', `Not enough MP to use ${item.name}. Need 20 MP.`);
                    }
                    break;

                case 'special':
                    if (item.name === 'Magic Crystal') {
                        const xpBonus = 50;
                        gameState.player.xp += xpBonus;
                        addLogEntry('system', `${commitMsg} - Absorbed power from ${item.name} ${item.emoji}! Gained ${xpBonus} XP.`);
                        checkLevelUp();
                        
                        // Remove crystal
                        gameState.inventory[selectedInventorySlot] = null;
                        selectedInventorySlot = null;
                        populateInventory();
                    }
                    break;

                case 'key':
                    addLogEntry('system', `${commitMsg} - The ${item.name} ${item.emoji} might be useful for unlocking secrets in this area.`);
                    break;

                case 'armor':
                    addLogEntry('system', `${commitMsg} - ${item.name} ${item.emoji} provides ${item.power} defense against attacks.`);
                    break;

                default:
                    addLogEntry('system', `${commitMsg} - Examined ${item.name} ${item.emoji}. It might be useful later.`);
                    break;
            }

            document.getElementById('commit-msg').value = '';
            updateDisplay();
        }

        function rest() {
            const commitMsg = document.getElementById('commit-msg').value || 'Taking a well-deserved rest...';
            const hpRestore = Math.min(25, gameState.player.maxHp - gameState.player.hp);
            const mpRestore = Math.min(30, gameState.player.maxMp - gameState.player.mp);
            
            gameState.player.hp += hpRestore;
            gameState.player.mp += mpRestore;
            
            addLogEntry('system', `${commitMsg} - Restored ${hpRestore} HP and ${mpRestore} MP.`);
            document.getElementById('commit-msg').value = '';
            updateDisplay();
        }

        function populateAdventureLog() {
            const log = document.getElementById('adventure-log');
            const entries = [
                { type: 'system', message: 'GitGuts adventure started! Ready to explore and conquer!' }
            ];

            log.innerHTML = entries.map(entry => 
                `<div class="log-entry ${entry.type}">
                    <strong>[${getCommitHash()}]</strong> ${entry.message}
                </div>`
            ).join('');
        }

        function getCommitHash() {
            return Math.random().toString(36).substr(2, 7);
        }

        function addLogEntry(type, message) {
            const log = document.getElementById('adventure-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<strong>[${getCommitHash()}]</strong> ${message}`;
            log.insertBefore(entry, log.firstChild);
            
            gameState.stats.commits++;
            updateDisplay();
        }

        function createParticles() {
            const particleContainer = document.getElementById('particles');
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (Math.random() * 5 + 8) + 's';
                particleContainer.appendChild(particle);
            }
        }

        // Auto-save game state
        setInterval(() => {
            console.log('Auto-saving game state...');
        }, 30000);

        // Initialize game on load
        initGame();

        // Add some random events
        setInterval(() => {
            if (Math.random() < 0.05) { // 5% chance every 15 seconds
                const events = [
                    'A mysterious merchant appears offering rare wares.',
                    'The weather changes, affecting your journey.',
                    'You hear distant sounds of adventure.',
                    'A shooting star grants you a small blessing.',
                    'Ancient magic stirs in the area...',
                    'You feel the presence of the area boss nearby.'
                ];
                const event = events[Math.floor(Math.random() * events.length)];
                addLogEntry('system', event);
            }
        }, 15000);
    </script>
</body>
</html>